<div 
  class="toolbar"
  [class.toolbar__inline]="mode() === 'inline'"
  [class.toolbar__top]="mode() === 'top'"
  [style.left.px]="mode() === 'inline' ? position().x : null"
  [style.top.px]="mode() === 'inline' ? position().y : null"
  [class.toolbar__top-position]="mode() === 'inline' && position().position === 'top'"
  [class.toolbar__bottom-position]="mode() === 'inline' && position().position === 'bottom'"
>
  <div class="toolbar__content">
    
    @if (config().showBlockStyle) {
    <div class="toolbar__group">
      <div class="toolbar__dropdown__wrapper">
        <button
          class="toolbar__dropdown"
          [tabindex]="mode() === 'top' ? 0 : -1"
          [disabled]="isOnLink()"
          zapEditorTooltip="Block Style"
          (click)="toggleDropdown('block_style', $event)"
          (keydown.enter)="mode() === 'top' ? toggleDropdown('block_style', $event) : null"
        >
          <div class="toolbar__trigger">
            <span>Tt</span>
            <i class="fa-regular fa-chevron-down"></i>
          </div>
        </button>
        @if (showDropdown === 'block_style') {
        <div 
          class="toolbar__dropdown__content" 
          [attr.role]="mode() === 'top' ? 'list' : null"
          [style.left.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.left : null"
          [style.top.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.top : null"
        >
          @for (style of blockStyles; track $index) {
          <div
            class="toolbar__option"
            [attr.role]="mode() === 'top' ? 'listitem' : null"
            [tabindex]="mode() === 'top' ? 0 : -1"
            (click)="selectBlockStyle($event, style.value)"
            (keydown.enter)="mode() === 'top' ? selectBlockStyle($event, style.value) : null"
          >
            <span [ngClass]="style.value">{{ style.label }}</span>
            <span class="toolbar__shortcut">{{ style.cmd }}</span>
          </div>
          }
        </div>
        }
      </div>
    </div>
    }

    @if (config().showUndoRedo) {
    <div class="toolbar__group">
      <button
        tabindex="0"
        (click)="undo.emit()"
        class="toolbar__button"
        zapEditorTooltip="Undo (Ctrl+Z)"
      >
        <i class="fa-regular fa-arrow-u-turn-up-left"></i>
      </button>
      <button
        tabindex="0"
        class="toolbar__button"
        (click)="redo.emit()"
        zapEditorTooltip="Redo (Ctrl+Y)"
      >
        <i class="fa-regular fa-arrow-u-turn-up-right"></i>
      </button>
    </div>
    }

    <div class="toolbar__group">
      @if (config().showBold) {
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="bold.emit()"
        zapEditorTooltip="Bold (Ctrl+B)"
      >
        <i class="fa-regular fa-bold"></i>
      </button>
      }
      @if (config().showItalic) {
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="italic.emit()"
        zapEditorTooltip="Italic (Ctrl+I)"
      >
        <i class="fa-regular fa-italic"></i>
      </button>
      }
      @if (config().showUnderline) {
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="underline.emit()"
        zapEditorTooltip="Underline (Ctrl+U)"
      >
        <i class="fa-regular fa-underline"></i>
      </button>
      }
      @if (config().showTextFormatting) {
      <div class="toolbar__dropdown__wrapper">
        <button
          class="toolbar__dropdown"
          [class.toolbar__dropdown__compact]="mode() === 'top'"
          [tabindex]="mode() === 'top' ? 0 : -1"
          zapEditorTooltip="Text Formatting"
          (click)="toggleDropdown('text_formatting', $event)"
          (keydown.enter)="mode() === 'top' ? toggleDropdown('text_formatting', $event) : null"
        >
          <i class="fa-regular fa-ellipsis-vertical"></i>
        </button>
        @if (showDropdown === 'text_formatting') {
        <div 
          class="toolbar__dropdown__content" 
          [attr.role]="mode() === 'top' ? 'list' : null"
          [style.left.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.left : null"
          [style.top.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.top : null"
        >
          @for (style of textFormattingStyles; track $index) {
          <div
            class="toolbar__option"
            [attr.role]="mode() === 'top' ? 'listitem' : null"
            [tabindex]="mode() === 'top' ? 0 : -1"
            (click)="selectTextFormattingOptions($event, style.value)"
            (keydown.enter)="mode() === 'top' ? selectTextFormattingOptions($event, style.value) : null"
          >
            <span>{{ style.label }}</span>
            <span class="toolbar__shortcut">{{ style.cmd }}</span>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>

    @if (mode() === 'inline') {
    <div class="toolbar__separator"></div>
    }

    @if (config().showAlignment) {
    <div class="toolbar__group">
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="onAlignClick('left')"
        (keydown.enter)="mode() === 'top' ? onAlignClick('left') : null"
        zapEditorTooltip="Align Left"
      >
        <i class="fa-regular fa-align-left"></i>
      </button>
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="onAlignClick('center')"
        (keydown.enter)="mode() === 'top' ? onAlignClick('center') : null"
        zapEditorTooltip="Align Center"
      >
        <i class="fa-regular fa-align-center"></i>
      </button>
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="onAlignClick('right')"
        (keydown.enter)="mode() === 'top' ? onAlignClick('right') : null"
        zapEditorTooltip="Align Right"
      >
        <i class="fa-regular fa-align-right"></i>
      </button>
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="onAlignClick('justify')"
        (keydown.enter)="mode() === 'top' ? onAlignClick('justify') : null"
        zapEditorTooltip="Justify"
      >
        <i class="fa-regular fa-align-justify"></i>
      </button>
    </div>
    }

    @if (mode() === 'inline') {
    <div class="toolbar__separator"></div>
    }

    @if (config().showLists) {
    <div class="toolbar__group">
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="list.emit('bullet')"
        (keydown.enter)="mode() === 'top' ? list.emit('bullet') : null"
        zapEditorTooltip="Bullet List"
      >
        <i class="fa-regular fa-list-ul"></i>
      </button>
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="list.emit('numbered')"
        (keydown.enter)="mode() === 'top' ? list.emit('numbered') : null"
        zapEditorTooltip="Numbered List"
      >
        <i class="fa-regular fa-list-ol"></i>
      </button>
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="list.emit('todo')"
        (keydown.enter)="mode() === 'top' ? list.emit('todo') : null"
        zapEditorTooltip="Todo List"
      >
        <i class="fa-regular fa-list-check"></i>
      </button>
    </div>
    }

    @if (mode() === 'inline') {
    <div class="toolbar__separator"></div>
    }

    <div class="toolbar__group">
      @if (config().showMention) {
      <button
        tabindex="0"
        (click)="at.emit()"
        (keydown.enter)="at.emit()"
        zapEditorTooltip="Mention"
      >
        <i class="fa-regular fa-at"></i>
      </button>
      }
      @if (config().showColor) {
      <div class="toolbar__dropdown__wrapper">
        <button
          class="toolbar__dropdown"
          [class.toolbar__dropdown__alt]="mode() === 'top'"
          [tabindex]="mode() === 'top' ? 0 : -1"
          zapEditorTooltip="Text Color"
          (click)="toggleDropdown('color', $event)"
          (keydown.enter)="mode() === 'top' ? toggleDropdown('color', $event) : null"
        >
          <div class="toolbar__trigger">
            <span class="toolbar__color" [style.background]="currentColor()"></span>
          </div>
        </button>
        @if (showDropdown === 'color') {
        <div 
          class="toolbar__dropdown__content toolbar__dropdown__content__color" 
          [attr.role]="mode() === 'top' ? 'list' : null"
          [style.left.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.left : null"
          [style.top.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.top : null"
        >
          @for (color of colors; track $index) {
          <div
            class="toolbar__option"
            [attr.role]="mode() === 'top' ? 'listitem' : null"
            [tabindex]="mode() === 'top' ? 0 : -1"
            [style.background]="color.value"
            (click)="selectColor($event, color.value)"
            (keydown.enter)="mode() === 'top' ? selectColor($event, color.value) : null"
          >
            <span class="sr-only">{{ color.label }}</span>
          </div>
          }
        </div>
        }
      </div>
      }
      @if (config().showLink) {
      <div class="toolbar__dropdown__wrapper">
        <button
          class="toolbar__dropdown"
          [class.toolbar__dropdown__alt]="mode() === 'top'"
          [tabindex]="mode() === 'top' ? 0 : -1"
          zapEditorTooltip="Insert Link"
          [disabled]="isOnLink()"
          (click)="toggleDropdown('link', $event)"
          (keydown.enter)="mode() === 'top' ? toggleDropdown('link', $event) : null"
        >
          <div class="toolbar__trigger"><i class="fa-regular fa-link"></i></div>
        </button>
        @if (showDropdown === 'link') {
        <div 
          class="toolbar__dropdown__content toolbar__dropdown__content__link"
          [style.left.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.left : null"
          [style.top.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.top : null"
        >
          <ze-link-card
            [href]="href()"
            [text]="text()"
            (add)="addLink($event)"
          ></ze-link-card>
        </div>
        }
      </div>
      }
      @if (config().showFileUpload) {
      <input
        #fileInput
        type="file"
        class="toolbar__file__input"
        (change)="file.emit($event)"
      />
      <button
        tabindex="0"
        (click)="fileInput.click()"
        (keydown.enter)="fileInput.click()"
        zapEditorTooltip="Upload Media"
        class="toolbar__media__trigger"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 46 46"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M37.2798 0.319824H8.71982C4.08982 0.319824 0.319824 4.07982 0.319824 8.71982V37.2798C0.319824 41.9098 4.08982 45.6798 8.71982 45.6798H37.2798C41.9098 45.6798 45.6798 41.9098 45.6798 37.2798V8.71982C45.6798 4.08982 41.9198 0.319824 37.2798 0.319824ZM43.1598 37.2798C43.1598 40.5198 40.5198 43.1598 37.2798 43.1598H8.71982C5.47982 43.1598 2.83982 40.5198 2.83982 37.2798V35.7498L14.2498 25.3498C14.4498 25.1698 14.7498 25.1698 14.9598 25.3498L22.2598 32.0498C22.8698 32.6098 23.6598 32.9098 24.4898 32.8498C25.3098 32.7998 26.0698 32.4298 26.6098 31.7998L34.7898 22.3298C34.9198 22.1898 35.0798 22.1498 35.1698 22.1498C35.2498 22.1498 35.4098 22.1498 35.5598 22.2898L43.1798 29.5298L43.1598 37.2798ZM43.1598 26.1898L37.3198 20.4998C36.7198 19.9098 35.8898 19.5998 35.0698 19.6398C34.2298 19.6698 33.4398 20.0598 32.8998 20.6898L24.7198 30.1598C24.5898 30.2998 24.4298 30.3398 24.3498 30.3398C24.2698 30.3398 24.1098 30.3398 23.9598 30.1998L16.6598 23.4998C15.4898 22.4298 13.7198 22.4298 12.5498 23.4998L2.83982 32.3498V8.71982C2.83982 5.47982 5.47982 2.83982 8.71982 2.83982H37.2798C40.5198 2.83982 43.1598 5.47982 43.1598 8.71982V26.1898Z"
          />
        </svg>
      </button>
      }
      @if (config().showCodeBlock) {
      <button
        class="toolbar__button"
        [tabindex]="mode() === 'top' ? 0 : -1"
        (click)="codeBlock.emit()"
        zapEditorTooltip="Code Block"
      >
        <i class="fa-regular fa-code"></i>
      </button>
      }
      @if (config().showMoreBlocks) {
      <div class="toolbar__dropdown__wrapper">
        <button
          tabindex="0"
          zapEditorTooltip="More Blocks"
          (click)="toggleDropdown('blocks', $event)"
          (keydown.enter)="toggleDropdown('blocks', $event)"
        >
          <i class="fa-regular fa-ellipsis-vertical"></i>
        </button>
        @if (showDropdown === 'blocks') {
        <div 
          class="toolbar__dropdown__content toolbar__dropdown__content__blocks"
          [style.left.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.left : null"
          [style.top.px]="mode() === 'inline' && dropdownPosition ? dropdownPosition.top : null"
        >
          <div class="toolbar__search__wrapper">
            <input type="text" id="search" placeholder="Search" />
          </div>
          @for (block of blocks; track $index) {
          <div
            class="toolbar__option"
            role="listitem"
            tabindex="0"
            (click)="selectBlock($event, block.value)"
            (keydown.enter)="selectBlock($event, block.value)"
          >
            <img [src]="block.img" [alt]="block.label" />
            <div class="toolbar__details">
              <span>{{ block.label }}</span>
              <span class="toolbar__shortcut">{{ block.descp }}</span>
            </div>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
  </div>
</div>
